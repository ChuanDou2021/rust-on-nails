"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.publish = void 0;
const docker_utils_1 = require("./docker-utils");
const get_tags_1 = require("./get-tags");
const normalize_config_1 = require("./normalize-config");
async function publish(pluginConfig, context) {
    const normalizedPluginConfig = normalize_config_1.normalizeConfig(pluginConfig);
    const { image } = normalizedPluginConfig;
    const { nextRelease: { version, channel }, logger, } = context;
    let tags = get_tags_1.getTags({ channel, version }, normalizedPluginConfig);
    tags = tags.map((tag) => `${image.name}:${tag}`);
    for (const tag of tags) {
        logger.log(`Tagging ${image.localNameWithSuffix} as ${tag}`);
        const { stdout } = await docker_utils_1.dockerTag(image.localNameWithSuffix, tag, context);
        logger.log(stdout);
    }
    // push each tag
    for (const tag of tags) {
        logger.log(`Pushing ${tag}`);
        const { stdout } = await docker_utils_1.dockerPush(tag, context);
        logger.log(stdout);
    }
}
exports.publish = publish;
//# sourceMappingURL=publish.js.map