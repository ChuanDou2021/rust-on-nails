"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.verifyConditions = void 0;
const docker_utils_1 = require("./docker-utils");
const normalize_config_1 = require("./normalize-config");
async function verifyConditions(pluginConfig, context) {
    const { logger, env } = context;
    const { skipLogin, image: { registry }, } = normalize_config_1.normalizeConfig(pluginConfig);
    if (skipLogin) {
        logger.log('Skipping docker login because skipLogin was set to true');
        return;
    }
    for (const envVar of ['DOCKER_USERNAME', 'DOCKER_PASSWORD']) {
        if (!env || !env[envVar]) {
            throw new Error(`Environment variable ${envVar} is not set`);
        }
    }
    try {
        await docker_utils_1.dockerLogin({
            userName: env.DOCKER_USERNAME,
            password: env.DOCKER_PASSWORD,
            registry: registry,
        }, context);
    }
    catch (err) {
        logger.error(err);
        throw new Error('docker login failed');
    }
}
exports.verifyConditions = verifyConditions;
//# sourceMappingURL=verify-conditions.js.map